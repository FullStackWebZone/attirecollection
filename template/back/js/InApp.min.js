$(document).ready(function () {
  $(
    '<style type="text/css">.inapp-btn{background-image:url("../template/back/js/benefitpay.jpg");background-size:100% 100%!important;height:126px;border:0!important;box-shadow:none!important;cursor:pointer!important}</style>'
  ).appendTo($("head"));
});
var InApp = {
  prefix: "ben",
  endpoint: "https://benefit-checkout.test-benefitpay.bh",
  errorCallback: null,
  successCallback: null,
  closeCallback: null,
  open: function (I, E, A, i) {
    if (
      ((this.successCallback = E),
      (this.errorCallback = A),
      (this.closeCallback = i),
      (I.paymentType && "" != I.paymentType) || (I.paymentType = "web"),
      (I.showResult && "" != I.showResult) || (I.showResult = 0),
      $(window).width() >= 768)
    )
      var C =
        "<div id='b_p' style='height: 100%!important;background-color: rgba(0,0,0,0.7)!important;position: fixed;overflow: auto;z-index:9999999999;top: 0;right: 0;bottom: 0;left: 0;box-sizing: border-box;border-radius: 0!important;'><div style='margin: 0 auto;width: 680px;height: 350px;margin-top: 40px;max-width: 100%;'><div style='position:relative;width:100%;height:100%;'><iframe onload='InApp.onMyFrameLoad(this)' style='width: 100%;height: 100%;border: 1px solid white !important;background-color:white !important;' src='" +
        this.endpoint +
        "/#/home?secure_hash=" +
        encodeURIComponent(I.secure_hash) +
        "&merchantId=" +
        I.merchantId +
        "&transactionAmount=" +
        I.transactionAmount +
        "&transactionCurrency=" +
        I.transactionCurrency +
        "&referenceNumber=" +
        I.referenceNumber +
        "&hashedString=" +
        I.hashedString +
        "&appId=" +
        I.appId +
        "&paymentType=" +
        I.paymentType +
        "&showResult=" +
        I.showResult +
        "'></iframe></div></div></div>";
    else
      C =
        "<div id='b_p' style='height: 100%!important;background-color: rgba(0,0,0,0.7)!important;position: fixed;overflow: auto;z-index:9999999999;top: 0;right: 0;bottom: 0;left: 0;box-sizing: border-box;border-radius: 0!important;'><div style='margin: 0 auto;width: 680px;height: 100%;margin-top: 0px;max-width: 100%;'><div style='position:relative;width:100%;height:100%;'><iframe onload='InApp.onMyFrameLoad(this)' style='width: 100%;height: 100%;border: 1px solid white !important;background-color:white !important;' src='" +
        this.endpoint +
        "/#/home?secure_hash=" +
        encodeURIComponent(I.secure_hash) +
        "&merchantId=" +
        I.merchantId +
        "&transactionAmount=" +
        I.transactionAmount +
        "&transactionCurrency=" +
        I.transactionCurrency +
        "&referenceNumber=" +
        I.referenceNumber +
        "&hashedString=" +
        I.hashedString +
        "&appId=" +
        I.appId +
        "&paymentType=" +
        I.paymentType +
        "&showResult=" +
        I.showResult +
        "&hideMobileQR=" +
        I.hideMobileQR +
        "'></iframe></div></div></div>";
    return $("html").append(C), "open";
  },
  close: function () {
    return (
      $("#b_p").remove(),
      this.closeCallback && this.closeCallback("CloseEvent"),
      "close"
    );
  },
  onMyFrameLoad: function () {
    $("#closebtn").css("display", "block");
  },
};
function getMobileOperatingSystem() {
  var I = navigator.userAgent || navigator.vendor || window.opera;
  return /windows phone/i.test(I)
    ? "Windows Phone"
    : /android/i.test(I)
    ? "Android"
    : /iPad|iPhone|iPod/.test(I) && !window.MSStream
    ? "iOS"
    : "unknown";
}
window.addEventListener("message", function (I) {
  if (I.data.status == InApp.prefix + "close") InApp.close();
  else {
    if (I.data.status == InApp.prefix + "inapp") {
      var E = encodeURIComponent(
        "https://benefit.bh/?inapp&app_id=" +
          I.data.appId +
          "&merchant_id=" +
          I.data.merchantId +
          "&qrdata=" +
          I.data.qrData +
          "&referenceNumber=" +
          I.data.referenceNumber +
          "&hashedString=" +
          I.data.hashedString +
          "&amount=" +
          I.data.transactionAmount +
          "&callBackTag=" +
          window.location.href +
          "&paymentType=" +
          I.data.paymentType +
          "&showResult=" +
          I.data.showResult
      );
      return void window.open(
        "https://tbenefituser.page.link/?link=" +
          E +
          "&apn=mobi.foo.benefittest&isi=1237673359&ibi=mobi.foo.benefituser",
        "_blank"
      );
    }
    I.data.status == InApp.prefix + "transaction" && I.data.data
      ? InApp.successCallback(I.data.data)
      : I.data.status != InApp.prefix + "transaction" || I.data.data
      ? I.data.status == InApp.prefix + "error" && InApp.errorCallback(I.data)
      : InApp.errorCallback(I.data.data);
  }
});
